##              尝试用microbit播放美妙的音乐

### 作者：鞠志翔————2200011035

### 摘要：microbit， music

### 一。创意介绍：

#### 对上面的发音功能有兴趣，所以打算写几首旋律。本想多整一点曲子，但music只支持偶数分音符，而且写music十分繁琐，所以从古典和流行分别选取了两段旋律规整且人民群众喜闻乐见的乐曲。

#### （喇叭声音实在寒碜，而且只能放单音，差点给舍友赶出去）

####        1.D大调卡农

####        2.只因你太美（部分旋律）

#### 由于放假，任务不妨分为若干天慢慢完成：5.3-5.7

### 二。三。设计方案和历程，与代码分析：

### 5.3

#### 项目主要引进了music, random,speech

```python 
from microbit import *
import music
import random
import speech
```

#### 按照使用习惯创建了最常用的三个8度：c3-c4,c4-c5.c5-c6,(手打，sigh)

```python
# 定义不同音符和节奏的频率和时长
c31 = {7:'b3:1',1.5:'c#3:1',2:'d3:1',2.5:'d#3:1',3:'e3:1',
       4:'f3:1',4.5:'f#3:1',5:'g3:1',5.5:'g#3:1',6:'a3:1',
       6.5:'a#3:1',1:'c3:1'}
c41 = {7:'b4:1',1.5:'c#4:1',2:'d4:1',2.5:'d#4:1',3:'e4:1',
       4:'f4:1',4.5:'f#4:1',5:'g4:1',5.5:'g#4:1',6:'a4:1',
       6.5:'a#4:1',1:'c4:1'}

c51 = {7:'b5:1',1.5:'c#5:1',2:'d5:1',2.5:'d#5:1',3:'e5:1',
       4:'f5:1',4.5:'f#5:1',5:'g5:1',5.5:'g#5:1',6:'a5:1',
       6.5:'a#5:1',1:'c5:1'}
c32 = {7:'b3:2',1.5:'c#3:2',2:'d3:2',2.5:'d#3:2',3:'e3:2',
       4:'f3:2',4.5:'f#3:2',5:'g3:2',5.5:'g#3:2',6:'a3:2',
       6.5:'a#3:2',1:'c3:2'}
c42 = {7:'b4:2',1.5:'c#4:2',2:'d4:2',2.5:'d#4:2',3:'e4:2',
       4:'f4:2',4.5:'f#4:2',5:'g4:2',5.5:'g#4:2',6:'a4:2',
       6.5:'a#4:2',1:'c4:2'}

c52 = {7:'b5:2',1.5:'c#5:2',2:'d5:2',2.5:'d#5:2',3:'e5:2',
       4:'f5:2',4.5:'f#5:2',5:'g5:2',5.5:'g#5:2',6:'a5:2',
       6.5:'a#5:2',1:'c5:2'}
c33 = {7:'b3:3',1.5:'c#3:3',2:'d3:3',2.5:'d#3:3',3:'e3:3',
       4:'f3:3',4.5:'f#3:3',5:'g3:3',5.5:'g#3:3',6:'a3:3',
       6.5:'a#3:3',1:'c3:3'}
c43 = {7:'b4:3',1.5:'c#4:3',2:'d4:3',2.5:'d#4:3',3:'e4:3',
       4:'f4:3',4.5:'f#4:3',5:'g4:3',5.5:'g#4:3',6:'a4:3',
       6.5:'a#4:3',1:'c4:3'}

c53 = {7:'b5:3',1.5:'c#5:3',2:'d5:3',2.5:'d#5:3',3:'e5:3',
       4:'f5:3',4.5:'f#5:3',5:'g5:3',5.5:'g#5:3',6:'a5:3',
       6.5:'a#5:3',1:'c5:3'}
c34 = {7:'b3:4',1.5:'c#3:4',2:'d3:4',2.5:'d#3:4',3:'e3:4',
       4:'f3:4',4.5:'f#3:4',5:'g3:4',5.5:'g#3:4',6:'a3:4',
       6.5:'a#3:4',1:'c3:4'}     
c44 = {7:'b4:4',1.5:'c#4:4',2:'d4:4',2.5:'d#4:4',3:'e4:4',
       4:'f4:4',4.5:'f#4:4',5:'g4:4',5.5:'g#4:4',6:'a4:4',
       6.5:'a#4:4',1:'c4:4'}

c54 = {7:'b5:4',1.5:'c#5:4',2:'d5:4',2.5:'d#5:4',3:'e5:4',
       4:'f5:4',4.5:'f#5:4',5:'g5:4',5.5:'g#5:4',6:'a5:4',
       6.5:'a#5:4',1:'c5:4'}
```

### 5.4

####  开始旋律，将应有的和弦省略或分解了，直接按记忆尽可能好听一点的来写：

每行大概就是一个小节，四二的拍子

```python
PACHELBEL = [
    
    c52[4.5], c42[4.5], c42[6], c52[2],
    c52[3],c42[3],c42[6],c52[1.5],
    c52[2],c42[2],c42[4.5],c42[7],
    c52[1.5],c42[1.5],c42[3],c42[6],
    c42[7],c32[7],c42[2],c42[5],
    c42[6],c32[6],c42[1.5],c42[3],
    c42[7],c42[2],c42[4.5],c42[7],
    c52[1.5],c42[3],c42[6],c52[1.5],

    c42[2],c32[4.5],c42[4.5],c32[2],
    c42[6],c32[6],c42[5],c42[1.5],
    c42[4.5],c32[4.5],c42[2],c32[6],
    c42[4.5],c32[4.5],c42[3],c32[5],
    c42[2],c32[4.5],c32[7],c32[4.5],
    c42[2],c32[4.5],c32[6],c32[2],
    c42[5],c42[3],c42[7],c42[1.5],
    c42[6],c42[1.5],c42[5],c42[3],

    c52[2],c52[1.5],c52[2],c42[2],
    c42[1.5],c42[6],c42[3],c42[4.5],
    c42[2],c52[2],c52[1.5],c42[7],
    c52[1.5],c52[4.5],c52[6],c52[7],
    c52[5],c52[4.5],c52[3],c52[5],
    c52[4.5],c52[3],c52[2],c52[1.5],
    c42[7],c42[6],c42[5],c42[4.5],
    c42[3],c42[5],c42[4.5],c42[3],

    
    c52[6],c51[4.5],c51[5],c52[6],c51[4.5],c51[5],
    c51[6],c41[6],c41[7],c51[1.5],c51[2],c51[3],c51[4.5],c51[5],
    c52[4.5],c51[2],c51[3],c52[4.5],c41[4.5],c41[5],
    c41[6],c41[7],c41[6],c41[5],c41[6],c41[4.5],c41[5],c41[6],
    c42[5],c41[7],c41[6],c42[5],c41[4.5],c41[3],
    c41[4.5],c41[3],c41[2],c41[3],c41[4.5],c41[5],c41[6],c41[7],
    c42[5],c41[7],c41[6],c42[7],c51[1.5],c51[2],
    c41[6],c41[7],c51[1.5],c51[2],c51[3],c51[4.5],c51[5],c51[6],
        
    c52[6],c51[4.5],c51[5],c52[6],c51[4.5],c51[5],
    c51[6],c41[6],c41[7],c51[1.5],c51[2],c51[3],c51[4.5],c51[5],
    c52[4.5],c51[2],c51[3],c52[4.5],c41[4.5],c41[5],
    c41[6],c41[7],c41[6],c41[5],c41[6],c51[2],c51[1.5],c51[2],
    c42[7],c51[2],c51[1.5],c42[7],c41[6],c41[5],
    c41[6],c41[5],c41[4.5],c41[5],c41[6],c41[7],c51[1.5],c51[2],
    c42[7],c51[2],c51[1.5],c52[2],c51[1.5],c41[7],
    c51[1.5],c51[2],c51[3],c51[2],c51[1.5],c51[2],c41[7],c51[1.5],

    c52[2],c42[2],c52[3],c52[2],  
    c42[1.5],c52[1.5],c42[7],c52[1.5],
    c32[7],c42[7],c52[1.5],c42[7],
    c32[6],c42[6],c42[5],c42[6],
    c42[5],c42[7],c52[1.5],c42[7],
    c42[6],c32[6],c32[5],c32[6],
    c32[5],c32[7],c32[6],c32[7],
    c42[1.5],c52[1.5],c42[7],c52[1.5],
    c42[2],c52[2],c52[3],c52[2],
    c52[1.5],c42[1.5],c32[7],c42[1.5],
    c42[2],c52[2],c52[3],c52[5],
    c52[4.5],c42[4.5],c42[3],c42[4.5],
    c52[5],c42[7],c52[2],c52[5],
    c52[3],c42[3],c42[6],c52[1.5],
    
    c52[2],c42[4.5],c42[6],c52[4.5],
    c52[6],c52[7],c52[6],c52[5],
    c52[4.5],c42[4.5],c42[6],c52[3],
    c52[4.5],c52[5],c52[4.5],c52[3],
    c52[2],c42[2],c42[5],c42[7],
    c52[2],c52[1],c42[7],c52[1],
    c42[6],c42[1.5],c42[3],c42[6],
    c52[2],c52[1],c42[1],c52[1],
    c52[1.5],c42[3],c42[6],c52[1.5],
    c44[2],c42[4.5],c43[6],c53[1.5],c54[2]
    ]
```

#### 再写一个播放函数 ，加上一些随机的自带的图案，以免过于单调

```python
   # 播放Pachelbel的D大调卡农
def Canon_in_D():
    music.set_tempo(bpm=130)

    # 定义显示图案
    images = [Image.HAPPY, Image.SAD, Image.YES,Image.NO,
              Image.HEART, Image.SQUARE,Image.TRIANGLE, 
              Image.CLOCK12,
              Image.CLOCK3,
              Image.CLOCK6,
              Image.CLOCK9,
              Image.ARROW_N,]
    
    # 循环播放乐谱
    for note in PACHELBEL:
        
        music.play(note)
        
        random_image = random.choice(images)
        display.show(random_image)
        
        
    display.clear()

    # 停止播放和显示
    music.stop()
    display.clear()
```

#### 这样第一个旋律就治好了

### 

#### 写一个鸡叫声，引出下文，这是旋律的一部分

```python 
def cxk():
    
    b1=speech.translate('ne' )
    b2=speech.translate('gan')
    b3=speech.translate('ma')
    b4=speech.translate('ha')
    b5=speech.translate('ha')
    b6=speech.translate('ai')
    b7=speech.translate('yo')
    speech.say(b1)
    speech.say(b2,pitch=40,speed=160)
    speech.sing(b3,pitch=36,speed=224)
    speech.sing(b4,speed=224)
    speech.sing(b5,speed=223)
    speech.sing(b6,speed=160)
    speech.say(b7)
```

#### 5月6日

#### 不知什么原因，鸡叫声好像有时候比较像，有时候很不像，不太稳定。原理是先翻译为音标，然后读出来，然后微调频率。

#### 写了只因你太美和迎面走来的你让我蠢蠢欲动的旋律（勉强能听出来）

```python
# 定义播放列表
taimei = [
    'f4:1','c5:2','c5:2','f4:1',
    'r:4','r:4','c3:1','c3:1','r:4','c#3:1','c3:1',
    'r:4','r:4','r:4',
    'f5:1','c5:1','c5:1','c5:1','c5:1','c5:1','c5:1',
    'c5:1','c5:1','c5:1','b4:1', 'c5:1',
    'f4:1','c5:2','c5:2','f4:1',
    'r:4','r:4','c3:1','c3:1','r:4','c#3:1','c3:1',
    'r:4','r:4','r:4',
    'f5:1','c5:1','c5:1','c5:1','c5:1','c5:1','c5:1',
    'c5:1','c5:1','c5:1','b4:1' ,'c5:1',
    'f4:1','c5:2','c5:2','f4:1',
    'r:4','r:4','c3:1','c3:1','r:4','c#3:1','c3:1',
    'r:4','r:4','r:4',
    'f5:1','c5:1','c5:1','c5:1','c5:1','c5:1','c5:1',
    'c5:1','c5:1','c5:1','b4:1', 'c5:1']

```

#### 为增加乐趣，写了一点跳舞的动图（今天发现好像发生撞题，所以尽量简略实现之）

```python
# 定义小人打篮球动画列表
basketball = [
    Image("09960:"
          "19099:"
          "00900:"
          "00900:"
          "09090"),
    Image("00790:"
          "00989:"
          "06986:"
          "00900:"
          "09090"),
    Image("09960:"
          "19099:"
          "00900:"
          "00900:"
          "09090"),
    Image("01790:"
          "00989:"
          "06986:"
          "00900:"
          "09090"),
    Image("09960:"
          "19099:"
          "00900:"
          "00900:"
          "09090"),
    Image("02790:"
          "00989:"
          "06986:"
          "00900:"
          "09090"),
    
    
    
]

# 定义转圈动画列表
circle = [
    Image("00900:"
          "09090:"
          "09000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "00000:"
          "09000:"
          "00000"),
    Image("00000:"
          "00900:"
          "09090:"
          "09000:"
          "00000"),
    Image("00000:"
          "00900:"
          "09090:"
          "00000:"
          "09000"),
    Image("00900:"
          "09090:"
          "09000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "09000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "09000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "00000:"
          "09000:"
          "00000"),
    Image("00000:"
          "00900:"
          "09090:"
          "09000:"
          "00000"),
    Image("00000:"
          "00900:"
          "09090:"
          "00000:"
          "09000"),
    Image("00900:"
          "09090:"
          "09000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "09000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "00000:"
          "09000:"
          "00000"),
    Image("00000:"
          "00900:"
          "09090:"
          "09000:"
          "00000"),
    Image("00000:"
          "00900:"
          "09090:"
          "00000:"
          "09000"),
    Image("00900:"
          "09090:"
          "09000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "09000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "00000:"
          "09000:"
          "00000"),
    Image("00900:"
          "09090:"
          "00000:"
          "00000:"
          "09000"),
    Image("00000:"
          "00900:"
          "09090:"
          "09000:"
          "00000"),
    Image("00000:"
          "00900:"
          "09090:"
          "00000:"
          "09000"),
    Image("00900:"
          "09090:"
          "00000:"
          "09000:"
          "00000"),
    Image("00900:"
          "09090:"
          "00090:"
          "00000:"
          "00000"),
    Image("00900:"
          "09099:"
          "00000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09009:"
          "00000:"
          "00000:"
          "00000"),
    Image("00900:"
          "09090:"
          "00000:"
          "00000:"
          "00000"),
]

# 定义显示图案和动画的函数
def display_animation(animation, speed=500, repeat=1):
    for i in range(repeat):
        for frame in animation:
            display.show(frame)
            sleep(speed)
    display.clear()


```

#### 经多次调试，达到了最清晰的效果

#### 边唱边跳：

```python
def chicken():
 # 配置音乐播放器
 music.set_tempo(bpm=120)
 for i in range(2):
    cxk() 
 # 循环播放播放列表中的曲目
    music.play(taimei, pin=pin0, wait=False)
    speech.say('be',speed=150)
    speech.say('be',speed=150)
 # 显示肩膀钴佣的动画
    display_animation(basketball, speed=225, repeat=3)
    cxk()  
    sleep(50)
 # 显示拍球扔球的动画
    display_animation(circle, speed=150, repeat=1)
    
    sleep(150)
 


    
 # 停止播放和清除显示
    music.stop()
    display.clear()
 
```

#### 好了，两段旋律都完成了，按A播放第一段，按B播放第二段

```python
while True:
  if button_a.is_pressed():
    Canon_in_D()
  elif button_b.is_pressed():
    chicken()
```

### 四。后续工作展望：

#### 很有趣，以后可以打更多的旋律进来。但打字确实很费劲，因为每打一个音符需要比写乐谱给多的时间，但后来越打越快了。旋律还算是可以。除了音乐功能，别的也了解了不少，感觉还很不错。很菜，但挺有趣，所以做了这些工作，大佬勿喷。

### 五。小组分工合作：

#### 小组人数：1人，鞠志翔2200011035工学院

